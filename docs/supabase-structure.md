<!--
  ╔══════════════════════════════════════════════════════════╗
  ║  GENERATED FILE — DO NOT EDIT MANUALLY                  ║
  ║                                                         ║
  ║  This file is auto-generated by:                        ║
  ║    npm run gen:db-docs                                  ║
  ║  Source: prisma/schema.prisma                           ║
  ║                                                         ║
  ║  Any manual edits will be overwritten on next run.      ║
  ║  To update, modify the Prisma schema and re-run the     ║
  ║  script.                                                ║
  ╚══════════════════════════════════════════════════════════╝
-->

# OutfAI — Supabase / Database Structure

> Auto-generated from `prisma/schema.prisma` by [`scripts/update-supabase-structure.ts`](../scripts/update-supabase-structure.ts).
> Last generated: 2026-02-20

---

## How This File Is Generated

1. The Prisma schema at `prisma/schema.prisma` is the single source of truth for the database.
2. Run `npm run gen:db-docs` to regenerate this file.
3. The script parses every `model` block and extracts columns, types, constraints, relations, and indexes.
4. **Hook into your workflow:**
   - Post-migrate: add `"postmigrate": "npm run gen:db-docs"` to `package.json` scripts
   - Pre-commit: add `npm run gen:db-docs && git add docs/supabase-structure.md` to your pre-commit hook

---

## Table List

| Table | Description | Row estimate |
|-------|-------------|-------------|
| `users` | User identity (managed by Supabase Auth + synced profile) | Low (10s-100s) |
| `garments` | Clothing items owned by users | Medium (100s per user) |
| `garment_tags` | Tags on garments (auto-generated or user-corrected) | Medium-High |
| `outfits` | Generated outfit instances | Medium |
| `outfit_items` | Junction: garments that belong to an outfit | Medium |
| `recommendation_logs` | User interaction tracking (shown/saved/skipped/worn) | High |
| `external_products` | Storefront items (optional commerce) | Low (future) |
| `product_matches` | Why a product matches a user's wardrobe (optional) | Low (future) |

---

## Table Definitions

### `users`

Synced from Supabase Auth. Stores profile data not covered by `auth.users`.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK | Matches `auth.users.id` from Supabase |
| `email` | `TEXT` | UNIQUE, NOT NULL | User email |
| `name` | `TEXT` | | Display name |
| `avatar_url` | `TEXT` | | Profile picture URL |
| `created_at` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | Account creation |
| `updated_at` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | Last profile update |

**Indexes:** PK on `id`

---

### `garments`

Individual clothing items in a user's wardrobe.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Unique garment ID |
| `user_id` | `TEXT` | FK → `users.id`, NOT NULL | Owner |
| `name` | `TEXT` | NOT NULL | Display name (e.g., "Blue Linen Shirt") |
| `category` | `TEXT` | NOT NULL | One of: tops, bottoms, shoes, outerwear, accessories |
| `primary_color` | `TEXT` | NOT NULL | Main color |
| `secondary_color` | `TEXT` | | Optional accent color |
| `material` | `TEXT` | | Fabric (cotton, wool, silk, linen, synthetic, etc.) |
| `season` | `TEXT` | NOT NULL | spring, summer, fall, winter, all-season |
| `image_original_url` | `TEXT` | | Full-resolution upload |
| `image_processed_url` | `TEXT` | | Color-analyzed version |
| `image_thumbnail_url` | `TEXT` | | CDN-cached thumbnail |
| `created_at` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | Upload timestamp |

**Indexes:**
- PK on `id`
- `idx_garments_user_id` on `user_id`
- `idx_garments_category` on `user_id, category`

**Foreign keys:**
- `user_id` → `users.id` (ON DELETE CASCADE)

---

### `garment_tags`

Tags assigned to garments by AI auto-tagging or user correction.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Unique tag record ID |
| `garment_id` | `TEXT` | FK → `garments.id`, NOT NULL | Tagged garment |
| `tag` | `TEXT` | NOT NULL | Tag value (e.g., "casual", "breathable") |
| `source` | `TEXT` | NOT NULL, DEFAULT `'auto'` | `auto` (system) or `user` (manual) |

**Indexes:**
- PK on `id`
- `idx_garment_tags_garment_id` on `garment_id`
- UNIQUE on `garment_id, tag` (no duplicate tags per garment)

**Foreign keys:**
- `garment_id` → `garments.id` (ON DELETE CASCADE)

---

### `outfits`

Generated outfit instances, persisted when a user saves them.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Unique outfit ID |
| `user_id` | `TEXT` | FK → `users.id`, NOT NULL | Owner |
| `context_weather` | `TEXT` | | Weather at generation time |
| `context_mood` | `TEXT` | | Mood selected at generation time |
| `explanation` | `TEXT` | | Human-readable reasoning |
| `score` | `INTEGER` | | Quality score (0-100) |
| `created_at` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | Generation timestamp |

**Indexes:**
- PK on `id`
- `idx_outfits_user_id` on `user_id`

**Foreign keys:**
- `user_id` → `users.id` (ON DELETE CASCADE)

---

### `outfit_items`

Junction table linking garments to outfits. Each row is one garment in an outfit.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Row ID |
| `outfit_id` | `TEXT` | FK → `outfits.id`, NOT NULL | Parent outfit |
| `garment_id` | `TEXT` | FK → `garments.id`, NOT NULL | Garment in the outfit |
| `position` | `INTEGER` | NOT NULL | Display order (0 = primary) |

**Indexes:**
- PK on `id`
- `idx_outfit_items_outfit_id` on `outfit_id`
- UNIQUE on `outfit_id, garment_id` (no duplicate garments per outfit)

**Foreign keys:**
- `outfit_id` → `outfits.id` (ON DELETE CASCADE)
- `garment_id` → `garments.id` (ON DELETE CASCADE)

---

### `recommendation_logs`

Tracks user interactions with generated outfits for analytics and future learning.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Row ID |
| `user_id` | `TEXT` | FK → `users.id`, NOT NULL | Acting user |
| `outfit_id` | `TEXT` | FK → `outfits.id` | Related outfit (nullable if outfit not saved) |
| `action` | `TEXT` | NOT NULL | One of: shown, saved, skipped, worn |
| `timestamp` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | When the action occurred |

**Indexes:**
- PK on `id`
- `idx_recommendation_logs_user_id` on `user_id`
- `idx_recommendation_logs_action` on `action`

**Foreign keys:**
- `user_id` → `users.id` (ON DELETE CASCADE)
- `outfit_id` → `outfits.id` (ON DELETE SET NULL)

---

### `external_products` (optional — commerce)

Storefront items from affiliate or partner feeds.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Product ID |
| `source` | `TEXT` | NOT NULL | Feed source (e.g., "amazon", "asos") |
| `name` | `TEXT` | NOT NULL | Product name |
| `category` | `TEXT` | NOT NULL | Matches garment categories |
| `color` | `TEXT` | | Primary color |
| `price` | `DECIMAL(10,2)` | | Price in USD |
| `image_url` | `TEXT` | | Product image |
| `product_url` | `TEXT` | NOT NULL | Link to buy |
| `created_at` | `TIMESTAMPTZ` | NOT NULL, DEFAULT `now()` | Import timestamp |

**Indexes:**
- PK on `id`
- `idx_external_products_category` on `category`

---

### `product_matches` (optional — commerce)

Explains why an external product complements a user's wardrobe.

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | `TEXT` | PK, DEFAULT `cuid()` | Row ID |
| `product_id` | `TEXT` | FK → `external_products.id`, NOT NULL | Suggested product |
| `garment_id` | `TEXT` | FK → `garments.id`, NOT NULL | Existing garment it complements |
| `reason` | `TEXT` | NOT NULL | Human-readable justification |

**Indexes:**
- PK on `id`
- `idx_product_matches_product_id` on `product_id`

**Foreign keys:**
- `product_id` → `external_products.id` (ON DELETE CASCADE)
- `garment_id` → `garments.id` (ON DELETE CASCADE)

---

## Relationships

```
users
  ├── 1:N → garments          (user owns garments)
  ├── 1:N → outfits            (user owns outfits)
  └── 1:N → recommendation_logs (user actions)

garments
  ├── 1:N → garment_tags       (garment has tags)
  ├── N:M → outfits            (via outfit_items junction)
  └── 1:N → product_matches    (garment matched to products)

outfits
  ├── 1:N → outfit_items       (outfit contains garments)
  └── 1:N → recommendation_logs (logs reference outfits)

external_products
  └── 1:N → product_matches    (product matched to garments)
```

---

## Migrations History

| Migration | Date | Description |
|-----------|------|-------------|
| _(none yet)_ | — | Prisma schema not yet initialized. Run `npx prisma migrate dev --name init` after Phase 0. |

---

## Assumptions

- Primary keys use `cuid()` (Prisma default) rather than UUID for shorter, URL-safe IDs.
- `users.id` mirrors `auth.users.id` from Supabase Auth (TEXT, not UUID type).
- All timestamps are `TIMESTAMPTZ` (timezone-aware).
- Commerce tables (`external_products`, `product_matches`) are optional and not created in the initial migration.
- ON DELETE CASCADE on all user-owned tables — deleting a user removes all their data.
